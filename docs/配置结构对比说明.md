# 配置结构对比说明

## 问题说明

用户提供的文档 `稳定状态各动态参数汇总表.md` 中定义的配置结构为：

```json
{
  "reportConfig": {
    "reportType": "StableStateSummary",
    "displayChannels": [...],
    "triggerLogic": {
      "combination": "AND",
      "condition1": {
        "enabled": true,
        "channel": "...",
        "statistic": "...",
        "duration_sec": 10,
        "logic": ">",
        "threshold": 8000
      },
      "condition2": {
        "enabled": false,
        "channel": "...",
        "statistic": "RateOfChange",
        "duration_sec": 1,
        "logic": "<",
        "threshold": 100
      }
    }
  }
}
```

但当前实际使用的 `samples/config_full.json` 结构为：

```json
{
  "reportConfig": {
    "stableState": {
      "displayChannels": [...],
      "conditionLogic": "AND",
      "conditions": [
        {
          "type": "statistic",
          "channel": "...",
          "statistic": "...",
          "duration": 10,
          "logic": ">",
          "threshold": 8000
        },
        {
          "type": "amplitude_change",
          "channel": "...",
          "duration": 1,
          "logic": "<",
          "threshold": 100
        }
      ]
    }
  }
}
```

## 差异分析

| 维度               | 文档结构                                             | 当前结构                     | 说明                   |
| ------------------ | ---------------------------------------------------- | ---------------------------- | ---------------------- |
| 顶层 key           | `reportType`, `displayChannels`, `triggerLogic`      | `stableState`                | 文档是平铺，当前是嵌套 |
| reporters 组合逻辑 | `triggerLogic.combination`                           | `stableState.conditionLogic` | 命名不同               |
| 条件定义方式       | `triggerLogic.condition1`, `triggerLogic.condition2` | `stableState.conditions[]`   | 文档是对象，当前是数组 |
| 条件类型标识       | 通过上下文（condition1/condition2）                  | `type` 字段                  | 文档隐式，当前显式     |
| 时间参数命名       | `duration_sec`                                       | `duration`                   | 命名不同               |
| 条件 2 类型        | `statistic: "RateOfChange"`                          | `type: "amplitude_change"`   | 标识方式不同           |
| enabled 字段       | 存在                                                 | 由数组元素存在性决定         | 文档显式，当前隐式     |

## 兼容性建议

### 方案 1：保持当前结构（推荐）

- **优点**：已实现且测试通过，结构更灵活，支持多条件扩展
- **缺点**：与文档不完全一致

### 方案 2：同时支持两种结构

```python
def _load_config(self, config_path: str) -> StableStateConfig:
    """加载配置，自动识别格式"""
    with open(config_path, 'r', encoding='utf-8') as f:
        config_data = json.load(f)

    report_config = config_data.get('reportConfig', {})

    # 检测配置格式
    if 'triggerLogic' in report_config:
        # 文档格式
        return self._parse_doc_format(report_config)
    elif 'stableState' in report_config:
        # 当前格式
        return self._parse_current_format(report_config)
    else:
        raise ValueError("不支持的配置格式")
```

### 方案 3：改为文档结构

- 需要修改所有配置解析代码
- 需要更新所有测试用例
- 需要更新 API 文档

## 推荐方案

建议采用**方案 1**，原因：

1. 当前结构更灵活，易于扩展
2. 逻辑功能完全一致
3. 已在生产环境使用
4. 可以添加配置验证确保符合约束

如果需要，我可以快速实现方案 2 的支持。
