# DRIA AI 助手 - 环境配置指南

## 创建 .env 文件

请在项目根目录（DRIA 目录）下创建 `.env` 文件，并填写以下内容：

```env
# DRIA AI助手 - 环境配置文件
# 请根据您选择的LLM提供商填写相应的API密钥

# ===========================================
# DeepSeek API配置（推荐）
# ===========================================
# DeepSeek API密钥 - 从 https://platform.deepseek.com/ 获取
DEEPSEEK_API_KEY=your_actual_api_key_here
# DeepSeek API基础URL（通常不需要修改）
DEEPSEEK_BASE_URL=https://api.deepseek.com
# DeepSeek模型名称（通常不需要修改）
DEEPSEEK_MODEL=deepseek-chat

# ===========================================
# OpenAI API配置（备选）
# ===========================================
# OpenAI API密钥 - 从 https://platform.openai.com/ 获取
# OPENAI_API_KEY=your_openai_api_key_here
# OpenAI API基础URL（使用官方API时不需要设置）
# OPENAI_BASE_URL=https://api.openai.com
# OpenAI模型名称
# OPENAI_MODEL=gpt-3.5-turbo

# ===========================================
# Anthropic Claude API配置（备选）
# ===========================================
# Anthropic API密钥 - 从 https://console.anthropic.com/ 获取
# ANTHROPIC_API_KEY=your_anthropic_api_key_here
# Anthropic模型名称
# ANTHROPIC_MODEL=claude-3-sonnet-20240229

# ===========================================
# Google Gemini API配置（备选）
# ===========================================
# Google API密钥 - 从 https://makersuite.google.com/ 获取
# GOOGLE_API_KEY=your_google_api_key_here
# Google模型名称
# GOOGLE_MODEL=gemini-pro

# ===========================================
# 应用配置
# ===========================================
# 调试模式（开发时建议设为True）
DEBUG=True
# 日志级别（DEBUG, INFO, WARNING, ERROR）
LOG_LEVEL=INFO
# API服务器主机地址
API_HOST=127.0.0.1
# API服务器端口
API_PORT=8000

# ===========================================
# 文件上传配置
# ===========================================
# 最大文件大小（字节），默认100MB
MAX_FILE_SIZE=104857600
# 允许的文件扩展名
ALLOWED_EXTENSIONS=.csv,.xlsx,.xls

# ===========================================
# 报表输出配置
# ===========================================
# 报表输出目录（相对于backend目录）
REPORT_OUTPUT_DIR=reports
# 文件上传目录（相对于backend目录）
UPLOAD_DIR=uploads

# ===========================================
# 数据库配置（开启DB存储报表所必需）
# ===========================================
# 使用PostgreSQL连接字符串（示例）：
# DATABASE_URL=postgresql+psycopg2://user:password@localhost:5432/driadb
# 若需连接主项目数据库，请参考下方说明更新连接串
# 启用后：上传文件可存DB、生成的报表写入DB、下载从DB读取
DATABASE_URL=
```

## 配置说明

### 1. LLM API 密钥配置

**推荐使用 DeepSeek（性价比高）：**

- 访问：https://platform.deepseek.com/
- 注册账号并获取 API 密钥
- 将密钥填入 `DEEPSEEK_API_KEY=your_actual_api_key_here`

**其他可选提供商：**

- **OpenAI**: https://platform.openai.com/
- **Anthropic Claude**: https://console.anthropic.com/
- **Google Gemini**: https://makersuite.google.com/

### 2. 必需配置项

**最低配置要求：**

```env
# 至少需要配置一个LLM API密钥
DEEPSEEK_API_KEY=your_actual_api_key_here

# 应用基础配置
DEBUG=True
LOG_LEVEL=INFO
```

### 3. 可选配置项

- `API_HOST`: 服务器地址（默认 127.0.0.1）
- `API_PORT`: 服务器端口（默认 8000）
- `MAX_FILE_SIZE`: 文件上传大小限制
- `REPORT_OUTPUT_DIR`: 报表输出目录
- `UPLOAD_DIR`: 文件上传目录
- `DATABASE_URL`: 设置后端数据库连接（PostgreSQL）。启用后报表改为 DB 存储。

### 4. 连接主项目数据库

- 与主项目保持同库：从主项目的配置文件或部署环境中找到已经使用的 `DATABASE_URL`（或等效的连接信息：用户名、密码、主机、端口、数据库名）。
- 将该连接字符串填入 `.env` 中的 `DATABASE_URL`，例如：

  ```env
  DATABASE_URL=postgresql+psycopg2://main_user:main_password@main-db-host:5432/main_database
  ```

- 确认网络连通性：确保当前运行 DRIA 的机器能够访问主项目数据库所在网络（若在内网或容器内需做好端口映射）。
- 确保权限一致：数据库用户需要具备读取上传文件、写入报表结果等权限，建议复用主项目的服务账号。
- 更新后重启后端服务，使新的数据库配置生效。

## 配置步骤

1. **创建 .env 文件**

   ```bash
   # 在DRIA目录下创建.env文件
   touch .env
   ```

2. **编辑 .env 文件**

   - 复制上面的配置模板
   - 将 `your_actual_api_key_here` 替换为您的真实 API 密钥
   - 根据需要调整其他配置项

3. **验证配置**

   ```bash
   cd backend
   python -c "from llm.factory import check_env_config; print(check_env_config())"
   ```

4. **启动服务**

   ```bash
   cd backend
   python main.py
   ```

## 注意事项

- **安全性**: 不要将 `.env` 文件提交到版本控制系统
- **API 密钥**: 确保 API 密钥有效且有足够的额度
- **网络**: 确保能够访问相应的 API 服务
- **权限**: 确保有文件读写权限
