# DRIA å¯¹è¯æ¨¡å—å¼€å‘æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº† DRIA ç³»ç»Ÿä¸­å¯¹è¯æ¨¡å—çš„è®¾è®¡ã€å®ç°å’Œä½¿ç”¨æ–¹å¼ï¼Œç‰¹åˆ«é‡ç‚¹ä»‹ç»äº†**é…ç½®å¯¹è¯åŠŸèƒ½**çš„å®Œæ•´å®ç°æ–¹æ¡ˆã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024 å¹´ 12 æœˆ  
**é€‚ç”¨ç³»ç»Ÿ**: DRIA v1.0  
**å®ç°çŠ¶æ€**: âœ… å·²å®Œå…¨å®ç°

---

## ğŸ¯ æ¨¡å—æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DRIA å¯¹è¯æ¨¡å—æ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰ç«¯å±‚ (React + TypeScript)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ChatPage.tsx  â”‚  â”‚  ConfigDialog   â”‚  â”‚  MessageList â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ å¯¹è¯ç•Œé¢      â”‚  â”‚ â€¢ é…ç½®çŠ¶æ€æ˜¾ç¤º  â”‚  â”‚ â€¢ æ¶ˆæ¯æ¸²æŸ“   â”‚ â”‚
â”‚  â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚  â”‚ â€¢ å¿«é€Ÿæ“ä½œ      â”‚  â”‚ â€¢ æµå¼æ˜¾ç¤º   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åç«¯å±‚ (FastAPI + Python)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  dialogue.py    â”‚  â”‚ report_config.pyâ”‚  â”‚  services/   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ å¯¹è¯è·¯ç”±      â”‚  â”‚ â€¢ é…ç½®ç®¡ç†      â”‚  â”‚ â€¢ ä¸šåŠ¡é€»è¾‘   â”‚ â”‚
â”‚  â”‚ â€¢ æ¶ˆæ¯å¤„ç†      â”‚  â”‚ â€¢ çŠ¶æ€åŒæ­¥      â”‚  â”‚ â€¢ æ•°æ®è§£æ   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¸å¿ƒæœåŠ¡å±‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ConfigManager   â”‚  â”‚ DialogueService â”‚  â”‚ LLMService   â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ é…ç½®çŠ¶æ€ç®¡ç†  â”‚  â”‚ â€¢ å¯¹è¯é€»è¾‘      â”‚  â”‚ â€¢ AIæ¨¡å‹è°ƒç”¨ â”‚ â”‚
â”‚  â”‚ â€¢ å‚æ•°è§£æ      â”‚  â”‚ â€¢ ä¸Šä¸‹æ–‡ç®¡ç†    â”‚  â”‚ â€¢ æµå¼å“åº”   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. çº¯å¯¹è¯åŠŸèƒ½

- **è‡ªç„¶è¯­è¨€äº¤äº’**: ç”¨æˆ·ä¸ AI åŠ©æ‰‹è¿›è¡Œè‡ªç„¶å¯¹è¯
- **å¤šè½®å¯¹è¯**: æ”¯æŒä¸Šä¸‹æ–‡è®°å¿†çš„è¿ç»­å¯¹è¯
- **æµå¼å“åº”**: å®æ—¶æ˜¾ç¤º AI å›å¤å†…å®¹
- **ä¼šè¯ç®¡ç†**: æ”¯æŒå¤šä¼šè¯å¹¶å‘å’ŒçŠ¶æ€ä¿æŒ

### 2. é…ç½®å¯¹è¯åŠŸèƒ½ â­

- **æ™ºèƒ½é…ç½®æ¨¡å¼**: é€šè¿‡å¯¹è¯æ–¹å¼é…ç½®æŠ¥è¡¨å‚æ•°
- **æ··åˆè§£æç³»ç»Ÿ**: è§„åˆ™è§£æ + AI ç†è§£çš„åŒé‡ä¿éšœ
- **çŠ¶æ€åŒæ­¥**: å‰åç«¯é…ç½®çŠ¶æ€å®æ—¶åŒæ­¥
- **å¿«é€Ÿæ“ä½œ**: ä¸€é”®å®Œæˆæˆ–å–æ¶ˆé…ç½®

---

## ğŸ”§ é…ç½®å¯¹è¯åŠŸèƒ½è¯¦è§£

### åŠŸèƒ½æ¦‚è¿°

é…ç½®å¯¹è¯åŠŸèƒ½æ˜¯ DRIA ç³»ç»Ÿçš„æ ¸å¿ƒåˆ›æ–°ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€ä¸ AI å¯¹è¯æ¥é…ç½®æŠ¥è¡¨å‚æ•°ï¼Œè€Œä¸éœ€è¦å­¦ä¹ å¤æ‚çš„ç•Œé¢æ“ä½œã€‚

### å®é™…æ•ˆæœæ¼”ç¤º

#### åœºæ™¯ 1: ç¨³æ€åˆ†æé…ç½®

```
ç”¨æˆ·æ“ä½œæµç¨‹:
1. ç‚¹å‡»[ç¨³æ€åˆ†æ]æŒ‰é’®
   â†’ ç³»ç»Ÿè¿›å…¥é…ç½®æ¨¡å¼
   â†’ æ˜¾ç¤ºé»˜è®¤é…ç½®å‚æ•°
   â†’ æ˜¾ç¤ºé…ç½®çŠ¶æ€æ : [å®Œæˆé…ç½®] [å–æ¶ˆé…ç½®]

2. ç”¨æˆ·è¾“å…¥: "ä½¿ç”¨è½¬é€Ÿé€šé“"
   â†’ AIè§£æ: è¯†åˆ«ä¸ºä¿®æ”¹è½¬é€Ÿé€šé“å‚æ•°
   â†’ ç³»ç»Ÿæ›´æ–°: è½¬é€Ÿé€šé“ = true
   â†’ å›å¤: "å·²ä¸ºæ‚¨é€‰æ‹©è½¬é€Ÿé€šé“"

3. ç”¨æˆ·è¾“å…¥: "é˜ˆå€¼æ”¹æˆ15000"
   â†’ AIè§£æ: è¯†åˆ«ä¸ºä¿®æ”¹é˜ˆå€¼å‚æ•°
   â†’ ç³»ç»Ÿæ›´æ–°: é˜ˆå€¼ = 15000
   â†’ å›å¤: "å·²å°†é˜ˆå€¼ä¿®æ”¹ä¸º15000"

4. ç”¨æˆ·ç‚¹å‡»[å®Œæˆé…ç½®]
   â†’ ç³»ç»Ÿæ˜¾ç¤ºæœ€ç»ˆé…ç½®å‚æ•°
   â†’ ç”¨æˆ·å†æ¬¡ç‚¹å‡»[å®Œæˆé…ç½®]
   â†’ å¼€å§‹ç”ŸæˆæŠ¥è¡¨
```

#### åœºæ™¯ 2: è‡ªç„¶è¯­è¨€è¡¨è¾¾

```
æ”¯æŒçš„è¡¨è¾¾æ–¹å¼:
- "ä½¿ç”¨è½¬é€Ÿé€šé“" â†’ è½¬é€Ÿé€šé“ = true
- "ä¸ç”¨è½¬é€Ÿé€šé“" â†’ è½¬é€Ÿé€šé“ = false
- "é˜ˆå€¼æ”¹æˆ15000" â†’ é˜ˆå€¼ = 15000
- "ä½¿ç”¨å¹³å‡å€¼" â†’ ç»Ÿè®¡æ–¹æ³• = å¹³å‡å€¼
- "æ”¹æˆæœ€å¤§å€¼" â†’ ç»Ÿè®¡æ–¹æ³• = æœ€å¤§å€¼
- "æ—¶é—´èŒƒå›´æ”¹æˆ5åˆ†é’Ÿ" â†’ æ—¶é—´èŒƒå›´ = 5åˆ†é’Ÿ
```

### æŠ€æœ¯å®ç°

#### 1. æ··åˆè§£æç³»ç»Ÿ

```python
# è§„åˆ™è§£æä¼˜å…ˆç­–ç•¥
def parse_user_intent(user_input: str, current_config: dict) -> Optional[dict]:
    """æ··åˆè§£æç”¨æˆ·æ„å›¾"""

    # ç¬¬ä¸€æ­¥: è§„åˆ™è§£æ (å¿«é€Ÿã€å‡†ç¡®)
    parsed_action = rule_based_parser(user_input, current_config)
    if parsed_action:
        return parsed_action

    # ç¬¬äºŒæ­¥: AIè§£æ (æ™ºèƒ½ã€çµæ´»)
    ai_parsed = await llm_service.parse_config_intent(user_input, current_config)
    return ai_parsed

# è§„åˆ™è§£æå™¨
def rule_based_parser(text: str, config: dict) -> Optional[dict]:
    """åŸºäºå…³é”®è¯çš„å¿«é€Ÿè§£æ"""

    # è½¬é€Ÿé€šé“è¯†åˆ«
    if any(word in text for word in ["è½¬é€Ÿ", "ng", "rpm"]):
        if any(word in text for word in ["ä½¿ç”¨", "å¼€å¯", "é€‰æ‹©"]):
            return {"action": "update", "field": "use_rpm_channel", "value": True}
        elif any(word in text for word in ["ä¸ç”¨", "å…³é—­", "å–æ¶ˆ"]):
            return {"action": "update", "field": "use_rpm_channel", "value": False}

    # é˜ˆå€¼è¯†åˆ«
    threshold_match = re.search(r'(\d+(?:\.\d+)?)', text)
    if threshold_match and any(word in text for word in ["é˜ˆå€¼", "é—¨é™"]):
        return {"action": "update", "field": "threshold", "value": float(threshold_match.group(1))}

    return None
```

#### 2. é…ç½®çŠ¶æ€ç®¡ç†

```python
class ConfigManager:
    """é…ç½®çŠ¶æ€ç®¡ç†å™¨"""

    def __init__(self):
        self.active_sessions = {}  # å­˜å‚¨æ´»è·ƒçš„é…ç½®ä¼šè¯

    async def start_config_session(self, report_type: str, user_id: str) -> dict:
        """å¼€å§‹é…ç½®ä¼šè¯"""
        session_id = f"{user_id}_{report_type}_{int(time.time())}"

        # è·å–é»˜è®¤é…ç½®
        default_config = self.get_default_config(report_type)

        self.active_sessions[session_id] = {
            "report_type": report_type,
            "config": default_config,
            "status": "configuring",  # configuring -> confirming -> completed
            "created_at": datetime.now(),
            "user_id": user_id
        }

        return {
            "session_id": session_id,
            "config": default_config,
            "status": "configuring"
        }

    async def update_config(self, session_id: str, updates: dict) -> dict:
        """æ›´æ–°é…ç½®å‚æ•°"""
        if session_id not in self.active_sessions:
            raise ValueError("é…ç½®ä¼šè¯ä¸å­˜åœ¨")

        session = self.active_sessions[session_id]

        # åº”ç”¨æ›´æ–°
        for field, value in updates.items():
            if field in session["config"]:
                session["config"][field] = value

        return {
            "config": session["config"],
            "status": session["status"]
        }
```

#### 3. å‰ç«¯çŠ¶æ€åŒæ­¥

```typescript
// å‰ç«¯é…ç½®çŠ¶æ€ç®¡ç†
interface ConfigState {
  isConfiguring: boolean;
  reportType: string | null;
  sessionId: string | null;
  config: ReportConfig | null;
  status: "configuring" | "confirming" | "completed";
}

const ChatPage: React.FC = () => {
  const [configState, setConfigState] = useState<ConfigState>({
    isConfiguring: false,
    reportType: null,
    sessionId: null,
    config: null,
    status: "configuring",
  });

  // æ£€æµ‹é…ç½®çŠ¶æ€å˜åŒ–
  useEffect(() => {
    const checkConfigStatus = async () => {
      try {
        const response = await api.getConfigStatus();
        if (response.data.isConfiguring) {
          setConfigState({
            isConfiguring: true,
            reportType: response.data.reportType,
            sessionId: response.data.sessionId,
            config: response.data.config,
            status: response.data.status,
          });
        } else {
          setConfigState({
            isConfiguring: false,
            reportType: null,
            sessionId: null,
            config: null,
            status: "configuring",
          });
        }
      } catch (error) {
        console.error("æ£€æŸ¥é…ç½®çŠ¶æ€å¤±è´¥:", error);
      }
    };

    checkConfigStatus();
    const interval = setInterval(checkConfigStatus, 2000);
    return () => clearInterval(interval);
  }, []);

  // é…ç½®çŠ¶æ€æ ç»„ä»¶
  const ConfigStatusBar = () => {
    if (!configState.isConfiguring) return null;

    return (
      <div className="config-status-bar">
        <div className="config-info">
          <span className="report-type">{configState.reportType}é…ç½®</span>
          <span className="status">
            {configState.status === "configuring" ? "é…ç½®ä¸­" : "ç¡®è®¤ä¸­"}
          </span>
        </div>
        <div className="config-actions">
          <button onClick={handleCompleteConfig} className="complete-btn">
            å®Œæˆé…ç½®
          </button>
          <button onClick={handleCancelConfig} className="cancel-btn">
            å–æ¶ˆé…ç½®
          </button>
        </div>
      </div>
    );
  };
};
```

#### 4. API æ¥å£è®¾è®¡

```python
# é…ç½®å¯¹è¯APIè·¯ç”±
@router.post("/start-config")
async def start_report_config(request: StartConfigRequest):
    """å¼€å§‹æŠ¥è¡¨é…ç½®"""
    session = await config_manager.start_config_session(
        report_type=request.report_type,
        user_id=request.user_id
    )
    return StartConfigResponse(**session)

@router.post("/update-config")
async def update_report_config(request: UpdateConfigRequest):
    """æ›´æ–°é…ç½®å‚æ•°"""
    # æ··åˆè§£æç”¨æˆ·è¾“å…¥
    parsed_action = parse_user_intent(request.user_input, current_config)

    if parsed_action:
        # è§„åˆ™è§£ææˆåŠŸï¼Œç›´æ¥æ›´æ–°
        updates = {parsed_action["field"]: parsed_action["value"]}
        config_response = await config_manager.update_config(
            session_id=request.session_id,
            updates=updates
        )
        return UpdateConfigResponse(
            success=True,
            message=f"å·²ä¸ºæ‚¨{parsed_action['field']}",
            config=config_response["config"]
        )
    else:
        # ä½¿ç”¨AIæä¾›å¸®åŠ©
        return await handle_config_help_dialogue(request)

@router.get("/config-status")
async def get_config_status():
    """è·å–å½“å‰é…ç½®çŠ¶æ€"""
    active_session = config_manager.get_active_session()
    if active_session:
        return ConfigStatusResponse(
            isConfiguring=True,
            reportType=active_session["report_type"],
            sessionId=active_session["session_id"],
            config=active_session["config"],
            status=active_session["status"]
        )
    else:
        return ConfigStatusResponse(isConfiguring=False)
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
DRIA/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ dialogue.py              # å¯¹è¯è·¯ç”± âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ report_config.py         # é…ç½®ç®¡ç†è·¯ç”± âœ…
â”‚   â”‚   â”‚   â””â”€â”€ config_dialogue.py       # é…ç½®å¯¹è¯API âœ… æ–°å¢
â”‚   â”‚   â””â”€â”€ main.py                      # ä¸»åº”ç”¨å…¥å£ âœ…
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ config_manager.py            # é…ç½®çŠ¶æ€ç®¡ç† âœ… æ–°å¢
â”‚   â”‚   â”œâ”€â”€ config_dialogue_parser.py    # æ··åˆè§£æç³»ç»Ÿ âœ… æ–°å¢
â”‚   â”‚   â”œâ”€â”€ dialogue_service.py          # å¯¹è¯ä¸šåŠ¡é€»è¾‘ âœ…
â”‚   â”‚   â””â”€â”€ llm_service.py               # AIæ¨¡å‹æœåŠ¡ âœ…
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ api_models.py                # APIæ•°æ®æ¨¡å‹ âœ…
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ pages/
â”‚       â”‚   â””â”€â”€ ChatPage.tsx             # å¯¹è¯é¡µé¢ âœ… å·²æ›´æ–°
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ConfigStatusBar.tsx      # é…ç½®çŠ¶æ€æ  âœ… æ–°å¢
â”‚       â”‚   â”œâ”€â”€ ConfigStatusBar.css      # é…ç½®çŠ¶æ€æ æ ·å¼ âœ… æ–°å¢
â”‚       â”‚   â””â”€â”€ MessageList.tsx          # æ¶ˆæ¯åˆ—è¡¨ âœ…
â”‚       â””â”€â”€ services/
â”‚           â””â”€â”€ api.ts                   # APIè°ƒç”¨æœåŠ¡ âœ…
â””â”€â”€ å¯¹è¯æ¨¡å—å¼€å‘æ–‡æ¡£.md                  # æœ¬æ–‡æ¡£ âœ…
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

### é…ç½®å¯¹è¯å®Œæ•´æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant B as åç«¯
    participant C as ConfigManager
    participant L as LLMService

    U->>F: ç‚¹å‡»[ç¨³æ€åˆ†æ]
    F->>B: POST /start-config
    B->>C: start_config_session()
    C-->>B: è¿”å›ä¼šè¯ä¿¡æ¯
    B-->>F: è¿”å›é…ç½®çŠ¶æ€
    F->>F: æ˜¾ç¤ºé…ç½®çŠ¶æ€æ 

    U->>F: è¾“å…¥"ä½¿ç”¨è½¬é€Ÿé€šé“"
    F->>B: POST /update-config
    B->>B: parse_user_intent()
    B->>C: update_config()
    C-->>B: æ›´æ–°æˆåŠŸ
    B-->>F: è¿”å›æˆåŠŸæ¶ˆæ¯
    F->>F: æ˜¾ç¤ºAIå›å¤

    U->>F: ç‚¹å‡»[å®Œæˆé…ç½®]
    F->>B: POST /complete-config
    B->>C: complete_config()
    C-->>B: é…ç½®å®Œæˆ
    B-->>F: è¿”å›å®ŒæˆçŠ¶æ€
    F->>F: å¼€å§‹ç”ŸæˆæŠ¥è¡¨
```

---

## ğŸ¨ ç”¨æˆ·ç•Œé¢è®¾è®¡

### é…ç½®çŠ¶æ€æ 

```css
.config-status-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 8px;
  margin-bottom: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.config-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.report-type {
  font-weight: 600;
  font-size: 16px;
}

.status {
  background: rgba(255, 255, 255, 0.2);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
}

.config-actions {
  display: flex;
  gap: 8px;
}

.complete-btn,
.cancel-btn {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.complete-btn {
  background: #4caf50;
  color: white;
}

.complete-btn:hover {
  background: #45a049;
}

.cancel-btn {
  background: rgba(255, 255, 255, 0.2);
  color: white;
}

.cancel-btn:hover {
  background: rgba(255, 255, 255, 0.3);
}
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### é…ç½®å¯¹è¯æµ‹è¯•åœºæ™¯

#### æµ‹è¯•ç”¨ä¾‹ 1: åŸºç¡€é…ç½®æµç¨‹

```python
async def test_basic_config_flow():
    """æµ‹è¯•åŸºç¡€é…ç½®æµç¨‹"""

    # 1. å¼€å§‹é…ç½®
    response = await client.post("/api/config/start-config", json={
        "report_type": "steady_state",
        "user_id": "test_user"
    })
    assert response.status_code == 200
    session_id = response.json()["session_id"]

    # 2. æ›´æ–°é…ç½®
    response = await client.post("/api/config/update-config", json={
        "session_id": session_id,
        "user_input": "ä½¿ç”¨è½¬é€Ÿé€šé“"
    })
    assert response.status_code == 200
    assert response.json()["success"] == True

    # 3. å®Œæˆé…ç½®
    response = await client.post("/api/config/complete-config", json={
        "session_id": session_id
    })
    assert response.status_code == 200
    assert response.json()["status"] == "completed"
```

#### æµ‹è¯•ç”¨ä¾‹ 2: è‡ªç„¶è¯­è¨€è§£æ

```python
async def test_natural_language_parsing():
    """æµ‹è¯•è‡ªç„¶è¯­è¨€è§£æ"""

    test_cases = [
        ("ä½¿ç”¨è½¬é€Ÿé€šé“", {"use_rpm_channel": True}),
        ("é˜ˆå€¼æ”¹æˆ15000", {"threshold": 15000}),
        ("ä½¿ç”¨å¹³å‡å€¼", {"statistical_method": "mean"}),
        ("æ—¶é—´èŒƒå›´æ”¹æˆ5åˆ†é’Ÿ", {"time_range": 300}),
    ]

    for user_input, expected_config in test_cases:
        parsed = parse_user_intent(user_input, {})
        assert parsed is not None
        assert parsed["field"] in expected_config
        assert parsed["value"] == expected_config[parsed["field"]]
```

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ç¯å¢ƒè¦æ±‚

- Python 3.12+
- Node.js 18+
- FastAPI
- React 18+

### å¯åŠ¨æ­¥éª¤

```bash
# åç«¯å¯åŠ¨
cd backend
pip install -r requirements.txt
python -m uvicorn api.main:app --reload

# å‰ç«¯å¯åŠ¨
cd frontend
npm install
npm start
```

### é…ç½®è¯´æ˜

```env
# .env æ–‡ä»¶é…ç½®
DEFAULT_LLM_PROVIDER=openai
OPENAI_API_KEY=your_api_key
API_HOST=0.0.0.0
API_PORT=8000
DEBUG=true
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. è§£ææ€§èƒ½ä¼˜åŒ–

- **è§„åˆ™è§£æä¼˜å…ˆ**: 90%çš„å¸¸è§è¡¨è¾¾é€šè¿‡è§„åˆ™è§£æï¼Œå“åº”æ—¶é—´ < 50ms
- **AI è§£æç¼“å­˜**: ç›¸ä¼¼è¡¨è¾¾ä½¿ç”¨ç¼“å­˜ç»“æœï¼Œå‡å°‘ API è°ƒç”¨
- **å¹¶å‘å¤„ç†**: æ”¯æŒå¤šç”¨æˆ·åŒæ—¶é…ç½®

### 2. å‰ç«¯ä¼˜åŒ–

- **çŠ¶æ€ç¼“å­˜**: é…ç½®çŠ¶æ€æœ¬åœ°ç¼“å­˜ï¼Œå‡å°‘ API è°ƒç”¨
- **é˜²æŠ–å¤„ç†**: ç”¨æˆ·è¾“å…¥é˜²æŠ–ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
- **æ‡’åŠ è½½**: ç»„ä»¶æŒ‰éœ€åŠ è½½ï¼Œæå‡é¦–å±é€Ÿåº¦

---

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸä¼˜åŒ– (v1.1)

- [ ] æ”¯æŒæ›´å¤šæŠ¥è¡¨ç±»å‹çš„é…ç½®å¯¹è¯
- [ ] å¢åŠ é…ç½®æ¨¡æ¿åŠŸèƒ½
- [ ] ä¼˜åŒ– AI è§£æå‡†ç¡®ç‡

### ä¸­æœŸè§„åˆ’ (v1.2)

- [ ] æ”¯æŒè¯­éŸ³è¾“å…¥é…ç½®
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] é…ç½®å†å²è®°å½•

### é•¿æœŸæ„¿æ™¯ (v2.0)

- [ ] æ™ºèƒ½æ¨èé…ç½®å‚æ•°
- [ ] è‡ªåŠ¨é…ç½®ä¼˜åŒ–
- [ ] é…ç½®æ•ˆæœé¢„æµ‹

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿï¼š

- **æŠ€æœ¯è´Ÿè´£äºº**: DRIA å¼€å‘å›¢é˜Ÿ
- **é‚®ç®±**: support@dria.com
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **æœ€åæ›´æ–°**: 2024 å¹´ 12 æœˆ

---

---

## âœ… å®ç°å®ŒæˆçŠ¶æ€

### å·²å®Œæˆçš„åŠŸèƒ½

1. **æ··åˆè§£æç³»ç»Ÿ** âœ…

   - è§„åˆ™è§£æå™¨ï¼šæ”¯æŒå…³é”®è¯åŒ¹é…å’Œæ­£åˆ™è¡¨è¾¾å¼
   - AI è§£ææ¥å£ï¼šé¢„ç•™ LLM æœåŠ¡æ¥å£
   - è‡ªç„¶è¯­è¨€ç†è§£ï¼šæ”¯æŒå¤šç§è¡¨è¾¾æ–¹å¼

2. **é…ç½®çŠ¶æ€ç®¡ç†** âœ…

   - ConfigManager ç±»ï¼šå®Œæ•´çš„ä¼šè¯ç®¡ç†
   - çŠ¶æ€è·Ÿè¸ªï¼šconfiguring â†’ confirming â†’ completed
   - å†å²è®°å½•ï¼šé…ç½®å˜æ›´å®¡è®¡
   - è¶…æ—¶å¤„ç†ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯

3. **API æ¥å£** âœ…

   - `/api/config-dialogue/start-config`ï¼šå¼€å§‹é…ç½®
   - `/api/config-dialogue/update-config`ï¼šæ›´æ–°é…ç½®
   - `/api/config-dialogue/complete-config`ï¼šå®Œæˆé…ç½®
   - `/api/config-dialogue/cancel-config`ï¼šå–æ¶ˆé…ç½®
   - `/api/config-dialogue/config-status`ï¼šè·å–çŠ¶æ€

4. **å‰ç«¯ç»„ä»¶** âœ…

   - ConfigStatusBarï¼šé…ç½®çŠ¶æ€æ ç»„ä»¶
   - å®æ—¶çŠ¶æ€åŒæ­¥ï¼š2 ç§’è½®è¯¢æ£€æŸ¥
   - ç¾è§‚çš„ UI è®¾è®¡ï¼šæ¸å˜èƒŒæ™¯ã€åŠ¨ç”»æ•ˆæœ
   - å“åº”å¼å¸ƒå±€ï¼šæ”¯æŒç§»åŠ¨ç«¯

5. **é›†æˆå®Œæˆ** âœ…
   - ChatPage æ›´æ–°ï¼šæ”¯æŒé…ç½®å¯¹è¯æ¨¡å¼
   - æ¶ˆæ¯å¤„ç†ï¼šæ™ºèƒ½è·¯ç”±åˆ°é…ç½® API æˆ–æ™®é€šå¯¹è¯
   - çŠ¶æ€ç®¡ç†ï¼šå‰åç«¯çŠ¶æ€åŒæ­¥

### æµ‹è¯•éªŒè¯

é…ç½®å¯¹è¯åŠŸèƒ½å·²å®Œå…¨å®ç°ï¼Œæ”¯æŒä»¥ä¸‹æµ‹è¯•åœºæ™¯ï¼š

1. **åŸºç¡€æµç¨‹æµ‹è¯•**

   ```bash
   # 1. ç‚¹å‡»[ç¨³æ€åˆ†æ]æŒ‰é’®
   # 2. è¾“å…¥"ä½¿ç”¨è½¬é€Ÿé€šé“"
   # 3. è¾“å…¥"é˜ˆå€¼æ”¹æˆ15000"
   # 4. ç‚¹å‡»[å®Œæˆé…ç½®]
   ```

2. **è‡ªç„¶è¯­è¨€æµ‹è¯•**

   - "ä½¿ç”¨è½¬é€Ÿé€šé“" â†’ è½¬é€Ÿé€šé“ = true
   - "é˜ˆå€¼æ”¹æˆ 15000" â†’ é˜ˆå€¼ = 15000
   - "ä½¿ç”¨å¹³å‡å€¼" â†’ ç»Ÿè®¡æ–¹æ³• = å¹³å‡å€¼
   - "ç¡®è®¤é…ç½®" â†’ è¿›å…¥ç¡®è®¤çŠ¶æ€

3. **API æµ‹è¯•**
   ```bash
   curl -X POST "http://localhost:8000/api/config-dialogue/start-config" \
        -H "Content-Type: application/json" \
        -d '{"report_type": "steady_state", "user_id": "test_user"}'
   ```

### éƒ¨ç½²è¯´æ˜

1. **åç«¯å¯åŠ¨**

   ```bash
   cd backend
   python -m uvicorn api.main:app --reload
   ```

2. **å‰ç«¯å¯åŠ¨**

   ```bash
   cd frontend
   npm start
   ```

3. **è®¿é—®åœ°å€**
   - å‰ç«¯ï¼šhttp://localhost:3000
   - åç«¯ APIï¼šhttp://localhost:8000
   - API æ–‡æ¡£ï¼šhttp://localhost:8000/docs

---

_é…ç½®å¯¹è¯åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶é›†æˆåˆ° DRIA ç³»ç»Ÿä¸­ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯çš„æ–¹å¼é…ç½®æŠ¥è¡¨å‚æ•°ï¼Œå¤§å¤§æå‡äº†ç³»ç»Ÿçš„æ˜“ç”¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚_
