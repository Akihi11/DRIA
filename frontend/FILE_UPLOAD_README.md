# 文件上传功能说明

## 功能概述

新增的文件上传功能允许用户在聊天界面中上传 CSV 和 Excel 文件，用于数据分析报表生成。

## 功能特性

### 文件类型限制

- **支持格式**: `.csv`, `.xlsx`, `.xls`
- **文件大小限制**: 最大 50MB
- **验证机制**: 前端和后端双重验证

### 用户界面

- **上传按钮**: 位于聊天输入框旁边
- **文件预览**: 上传前显示文件信息确认
- **进度显示**: 上传过程中显示进度条
- **状态反馈**: 上传成功/失败的消息提示

### 集成功能

- **聊天集成**: 上传成功后自动在聊天中显示系统消息
- **AI 响应**: 上传完成后 AI 会提供分析建议
- **状态管理**: 完整的文件状态跟踪

## 技术实现

### 组件结构

```
frontend/src/components/FileUpload/
├── FileUploadButton.tsx    # 主上传组件
└── FileUploadButton.css    # 样式文件
```

### 核心功能

1. **文件验证**: 检查文件类型和大小
2. **上传处理**: 使用 FormData 上传到后端 API
3. **状态管理**: 上传进度和错误处理
4. **UI 反馈**: 模态框预览和进度显示

### API 集成

- **上传端点**: `/api/ai_report/upload`
- **响应格式**: 包含文件 ID、文件名、大小等信息
- **错误处理**: 完整的错误信息反馈

## 使用方法

### 基本使用

1. 进入聊天页面
2. 点击"上传"按钮
3. 选择 CSV 或 Excel 文件
4. 确认上传
5. 等待上传完成

### 文件要求

- **CSV 文件**: 标准逗号分隔格式
- **Excel 文件**: .xlsx 或.xls 格式
- **数据格式**: 时序数据，包含时间列和数值列

## 错误处理

### 常见错误

- **文件类型错误**: 提示只支持 CSV 和 Excel 格式
- **文件过大**: 提示文件大小限制
- **上传失败**: 显示具体错误信息
- **网络错误**: 自动重试机制

### 用户提示

- 文件类型限制提示
- 文件大小限制提示
- 上传进度显示
- 成功/失败状态反馈

## 测试验证

### 功能测试

- 文件类型验证测试
- 文件大小验证测试
- 上传流程测试
- 错误处理测试

### 手动测试

1. 启动前端应用: `npm run dev`
2. 访问聊天页面: `http://localhost:3000/chat`
3. 测试不同文件格式
4. 验证错误处理机制

## 后续优化

### 计划改进

- 拖拽上传支持
- 批量文件上传
- 文件预览功能
- 上传历史记录

### 性能优化

- 分片上传大文件
- 上传队列管理
- 缓存机制优化
