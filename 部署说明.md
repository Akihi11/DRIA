# DRIA 系统部署说明

## 📁 项目结构

### 根目录结构

```
DRIA/
├── agent/            # AI Agent 模块
├── backend/          # 后端应用（完整独立）
├── docker/           # Docker 配置
├── docs/             # 项目文档
├── frontend/         # 前端应用（完整独立）
├── samples/          # 示例数据和配置
├── web/              # Web 静态资源
├── .gitignore        # Git 忽略规则
├── 建议操作逻辑树.md  # AI 对话逻辑文档
├── 测试指南.md        # 测试文档
├── 部署说明.md        # 本文档
└── 项目进展.md        # 进度跟踪
```

### Backend 目录结构

```
backend/
├── api/              # API 路由和端点
│   ├── routes/       # 路由模块
│   └── main.py       # FastAPI 应用
├── interfaces/       # 接口定义（抽象基类）
├── models/           # 数据模型定义
├── services/         # 业务服务层
│   ├── real_*.py     # 真实实现
│   └── mock_*.py     # 模拟实现
├── reports/          # 生成的报表输出
│   ├── api_generated/    # API 生成的报表
│   ├── golden_standard/  # 标准报表
│   └── test_reports/     # 测试报表
├── tests/            # 单元测试
├── uploads/          # 上传的数据文件
├── config.py         # 配置文件
├── main.py           # 入口文件
└── requirements.txt  # Python 依赖
```

### Frontend 目录结构

```
frontend/
├── src/
│   ├── components/   # React 组件
│   ├── pages/        # 页面组件
│   ├── services/     # API 服务
│   ├── store/        # 状态管理
│   ├── types/        # TypeScript 类型
│   └── utils/        # 工具函数
├── package.json      # Node.js 依赖
└── vite.config.ts    # Vite 配置
```

---

## 🚀 系统启动

### 环境要求

- Python 3.11+
- Node.js 16+

### 启动步骤

#### 1. 启动后端服务

```bash
cd backend

python start_server.py
```

**注意事项：**

- 后端服务必须从项目根目录启动，以确保正确的模块导入路径
- 不要在 backend 目录内启动服务
- 如果出现端口被占用

```bash
netstat -ano findstr 8000

taskkill /PID 40300 /F
```

> 40300 替换成监听到的进程号

**启动成功标志**:

```
🚀 启动AI报表生成API服务器 (Python 3.11)...
✅ Python 3.11+ 检测通过
✅ 核心依赖已安装
📍 服务地址: http://127.0.0.1:8000
📚 API文档: http://127.0.0.1:8000/api/docs
INFO:     Uvicorn running on http://127.0.0.1:8000
INFO:     Application startup complete.
```

#### 2. 启动前端服务

```bash
# 进入前端目录
cd frontend

# 首次启动需要安装依赖
npm install

# 启动服务
npm run dev
```

**启动成功标志**:

```
VITE v5.4.20  ready in 289 ms
  ➜  Local:   http://localhost:5173/
  ➜  Network: http://172.29.112.1:5173/
  ➜  Network: http://192.168.1.101:5173/
```

## 🌐 系统访问

### 前端应用 (主要使用入口)

**地址**: http://localhost:3000

**包含页面**:

- 首页: 项目介绍和导航
- AI 对话页: 文件上传和智能对话
- 报表管理页: 查看和下载生成的报表

### 后端 API 服务

**API 文档**: http://127.0.0.1:8000/api/docs  
**健康检查**: http://127.0.0.1:8000/api/health

**预期响应**:

```json
{
  "status": "healthy",
  "timestamp": "2025-09-18T15:32:00",
  "version": "1.0.0"
}
```

## ✅ 功能验证

### 基础功能测试

1. **文件上传测试**

   - 在 AI 对话页点击"上传文件"
   - 选择 CSV/Excel 文件上传
   - 预期: 显示上传进度，成功后显示文件信息

2. **AI 对话测试**

   - 上传文件后发送消息如"帮我分析数据"
   - 预期: AI 返回分析建议和配置选项

3. **报表生成测试**

   - 按 AI 建议完成配置
   - 预期: 成功生成 Excel 报表并可下载

4. **报表管理测试**
   - 访问报表管理页面
   - 预期: 显示已生成的报表列表，可下载

## 🔧 常见问题

### 后端启动失败

**问题 1**: ModuleNotFoundError: No module named 'backend'

**原因**: 在错误的目录启动了后端服务

**解决方案**:

```bash
# 确保在项目根目录（DRIA/）启动服务
cd d:\PythonCode\DRIA
python -m uvicorn backend.api.main:app --host 127.0.0.1 --port 8000 --reload
```

**问题 2**: 依赖缺失或 pip 损坏

```bash
# 症状：❌ 缺少依赖: No module named 'fastapi'
# 或者：No module named pip

# 解决方案（确保已激活虚拟环境）
.venv\Scripts\activate

# 如果提示 "No module named pip"，先修复 pip
python -m ensurepip --upgrade

# 然后安装依赖
cd backend
python -m pip install -r requirements.txt
```

**问题 2**: 虚拟环境混乱（pip 安装到错误的 Python 版本）

```bash
# 症状：pip 安装显示 "d:\python312\lib\site-packages"
# 但运行时使用的是 Python 3.11

# 解决方案：
# 1. 确认使用正确的 Python
python --version  # 应该显示 3.11.x

# 2. 修复 pip
python -m ensurepip --upgrade

# 3. 使用 python -m pip 而不是直接用 pip
cd backend
python -m pip install -r requirements.txt
```

**问题**: 端口被占用

```bash
# 检查端口
netstat -an | findstr ":8000"
# 杀死占用进程或重启
```

### 前端启动失败

**问题**: 依赖缺失

```bash
# 解决方案
cd frontend
npm install
```

**问题**: 端口被占用

```bash
# 检查端口
netstat -an | findstr ":3000"
# 杀死占用进程或重启
```

### 前后端通信失败

1. 确认后端在 8000 端口正常运行
2. 确认前端在 3000 端口正常运行
3. 浏览器 F12 查看 Network 标签检查 API 请求

## 📊 预期性能

- **页面加载**: < 3 秒
- **API 响应**: < 3 秒
- **文件上传**: 根据文件大小，有进度显示
- **报表生成**: < 30 秒

---

**系统启动完成后，即可通过 http://localhost:3000 开始使用完整的 AI 报表生成功能！**
